% Статья про разработку QReal:Robots и применение DSM-подхода, для сборника кафедры

\documentclass[a4paper]{article}
\usepackage[a4paper, top=17mm, bottom=17mm, left=17mm, right=17mm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T2A,T1]{fontenc}
\usepackage[colorlinks,filecolor=blue,citecolor=green,unicode,pdftex]{hyperref}
\usepackage{cmap}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amssymb,amsfonts,textcomp}
\usepackage{color}
\usepackage{array}
\usepackage{hhline}
\hypersetup{colorlinks=true, linkcolor=blue, citecolor=blue, filecolor=blue, urlcolor=blue, pdftitle=1, pdfauthor=, pdfsubject=, pdfkeywords=}
\usepackage{graphicx}
\usepackage{indentfirst}
%\usepackage{wrapfig}

\sloppy
\pagestyle{plain}

\title{Применение DSM-платформы QREAL при разработке среды программирования роботов QReal:Robots}

\author{Ю.В.Литвинов \\ ст. преп. кафедры системного программирования СПбГУ, \\ инженер-программист ЗАО ``Ланит-Терком'' \\ yurii.litvinov@gmail.com}
\date{}
\begin{document}

\maketitle
\thispagestyle{empty}

\renewcommand{\thefootnote}{}
\footnote{\small{\copyright~Ю.В.Литвинов,~2012.}}
\renewcommand{\thefootnote}{\arabic{footnote}}
\setcounter{footnote}{0}

\begin{quote}
\small\noindent
Абстракт
\end{quote}

\section*{Введение}
Идея использовать роботов при начальном обучении информатике родилась неслучайно. Проблема, на которую указывал ещё Ф.~Брукс в своей известной книге ``Мифический человеко-месяц''~\ref{mythicalManMonth}, заключается в том, что программы нематериальны, их невозможно увидеть или потрогать. Кроме того, даже представить себе программу не так просто --- каждый человек ``видит'' программу по-разному. Людям, которые впервые пробуют программировать, приходится сразу же работать с абстрактными понятиями, и судить о правильности своих программ они могут только по внешним проявлениям их работы --- какой ответ программа выведет на экран. При этом может быть совсем не очевидно, как программа работает, что делать, если выводимый ей ответ неправильный, что нужно делать, чтобы получить правильный ответ, к тому же часто случается так, что программа работает неправильно, но правильный ответ всё-таки выводит. Всё это делает изучение информатики в школе весьма сложным.

И отечественные, и зарубежные методисты давно осознают эту проблему, поэтому традиционно начальное обучение информатике проводится с использованием концепции исполнителя: некоторого, зачастую воображаемого, устройства, способного выполнять простые команды в некотором простом окружении. Один из самых известных исполнителей, применяемых в школах --- ``черепашка'' LOGO~\ref{logo}, разработанная американским программистом, психологом и педагогом Сеймуром Пейпертом в 1967 году. Исполнитель ``черепашка'' может перемещаться по экрану, оставляя за собой след, которым вычерчиваются различные фигуры. Черепашка подчиняется командам простого интерпретируемого языка, позволяющего описывать её перемещения и повороты. Таким образом, процесс исполнения программы визуализируется движением исполнителя по экрану, и если программа работает неправильно, это будет сразу видно. 

В Советском Союзе преподавание информатики как школьного предмета началось во многом благодаря усилиям академика А.П.~Ершова и его коллектива, в который входили Г.А.~Звенигородский и Н.А.~Юнерман. Ими была разработана отечественная учебная система ``Робик''~\ref{robik}, основанная в основном на тех же принципах, что и LOGO. Ими же были разработаны методики и программы преподавания информатики в школах, где понятие ``исполнитель'' занимало ключевую позицию.

Однако, исполнитель, перемещающийся по экрану, всё же недостаточно нагляден. Сеймур Пейперт в своих экспериментах использовал механическую черепашку~\ref{logoTurtle} --- реальный, осязаемый объект, исполняющий программу, гораздо понятнее для школьников, чем черепашка, движущаяся по экрану. Современные технологии позволяют создавать недорогие механические устройства, управляемые загружаемой в них программой, либо непосредственно с компьютера, поэтому идея использования материальных исполнителей в школьной информатике получила второе рождение. Самым популярным на данный момент исполнителем является кибернетический конструктор Lego Mindstorms NXT, активно внедряемый сейчас в российских школах. Для преподавания информатики с использованием этого конструктора создаются методические пособия (например,~\ref{filippov}) и образовательные программы. 

Робототехнический конструктор довольно сложно программировать: поскольку из набора деталей могут быть собраны самые разные конструкции, программировать приходится в терминах оборотов моторов, подключённых к определённым портам управляющего блока, а не в терминах движения и поворотов. Это, безусловно, делает процесс обучения более творческим, поскольку школьники могут собрать своего собственного исполнителя, но и более сложным с точки зрения написания для этого исполнителя программ. Проблема сложности программирования преодолевается использованием наглядных визуальных языков и удобных графических редакторов для составления программ из блоков, представляющих элементарные команды, такие как ``включить мотор'', ``гудок'' и т.д. Таким образом, начинающие работают с графическими языками программирования (которых сейчас для Mindstorms NXT существует достаточно много), а более опытные школьники постепено переходят на текстовые C-образные языки. В комплекте с конструктором поставляется графическая среда программирования NXT-G, поэтому визуальные языки среди использующих Mindstorms NXT весьма популярны.

На кафедре системного программирования Санкт-Петербургского Государственного Университета уже несколько десятилетий занимаются исследованиями в области визуальных языков, в частности, с 2007 года существует и активно развивается проект QReal~\ref{qReal}. В рамках этого проекта исследуются средства создания визуальных предметно-ориентированных языков. Предметно-ориентированный подход к созданию программного обеспечения основан на том, что иногда задачу проще решать, создав для её решения специализированный язык и решая задачу на нём, чем использовать язык общего назначения. При этом в исследовательской группе, работающей над проектом QReal, полагают, что визуальные языки гораздо более наглядны, чем текстовые, поэтому больше подходят как средства предметно-ориентированного программирования. Разумеется, создавать визуальный язык и средства поддержки для него (такие как редактор диаграмм, генераторы кода) с нуля было бы слишком трудозатратно, что свело бы на нет все преимущества от узкой специализированности языка, поэтому создаются средства, позволяющие автоматизировать часть этого процесса. Если обычные среды для визуального моделирования и визуального программирования называют CASE-средствами, то средства для создания таких сред называют обычно metaCASE-средствами, QReal --- пример metaCASE-системы.

Программирование роботов является интересной предметной областью для апробации metaCASE-системы. С одной стороны, использование визуальных языков программирования довольно широко распространено среди людей, занимающихся робототеникой, поэтому можно рассчитывать на содержательное сравнение с существующими решениями и содержательные отзывы пользователей, уже знакомых с различными визуальными языками. С другой стороны, программирование роботов --- хороший пример предметной области, достаточно узкой, чтобы можно было получить заметное преимущество от создания для неё специализированного языка, и вместе с тем достаточно содержательной, чтобы такой специализированный язык был нетривиальным, и мог бы послужить примером для исследования вопросов, применимых в других содержательных случаях. Типичные программы для роботов состоят из элементарных команд роботу, таких как "включить моторы", "ожидать такое-то показание сенсора" и т.д., и управляющих конструкций, таких как условные операторы и циклы. На языке общего назначения такие команды были бы вызовами API операционной системы или библиотек робота, и требовали бы для себя различных вспомогательных конструкций, таких как операторы включения и объявления переменных, а на специализированном языке каждая такая команда представляется одним блоком, для использования которого достаточно просто разместить его на диаграмме. Это существенно снижает требования к знаниям программиста и снижает вероятность ошибки в программе --- например, невозможно опечататься при указании имени вызываемой функции. Вместе с тем, многие языковые конструкции, типичные для императивного программирования, такие как ветвления и циклы, будут присутствовать и в этом языке, так что если удастся подобрать удобное графическое представление для программ для роботов, можно надеяться обобщить полученный результат на другие задачи, хорошо выражаемые в императивных терминах.

Было логичным попробовать применить разрабатываемую в том числе и автором данной статьи metaCASE-систему QReal к возникшей задаче программирования роботов, тем более что с предложением создать такую среду на основе QReal обратились специалисты по робототехнике. Довольно быстро (за время порядка нескольких часов) с использованием редактора визуальных языков из состава QReal был создан прототип редактора визуального языка программирования роботов, затем несколько недель ушло на разработку инструментальной поддержки для него, включающей в себя интерпретатор, управляющий роботом Lego NXT по Bluetooth-интерфейсу, отладочный эмулятор и двухмерную модель робота. В дальнейшем язык и инструментальные средства вокруг него совершенствовались и расширялись, задачам и трудностям, возникшим при этом, и роли DSM-инструментария в процессе разработки посвящена дальнейшая часть статьи.

Изложенные в данной статье результаты могут быть интересны тем, что разрабатываемую с помощью DSM-инструментария CASE-систему удалось довести до состояния, в котором её смогли успешно использовать люди, занимающиеся робототехникой и далёкие от программирования, в том числе и ученики пятых-шестых классов. Таким образом, по результатам этой апробации DSM-подход доказал свою применимость не только как средство создания специализированных инструментов для узкого круга пользователей, но и для разработки сред, предназначенных для массового потребителя, и используемых в образовательных и развлекательных целях. Среда QReal:Robots была представлена на ряде конференций и семинаров школьных учителей, роботы, запрограммированные с её помощью студентами, выступали на городских и всероссийских робототехнических фестивалях и соревнованиях. По отзывам конечных пользователей --- учеников школ --- среда QReal:Robots удобее, чем используемые ими средства программирования, и обладает более дружественным пользовательским интерфейсом.

\section{Средства визуального программирования роботов}

\section{DSM и QReal}

\section{QReal:Robots}

\section{Применение QReal в разработке QReal:Robots}

\section*{Заключение}
В результате применения описанного в статье подхода удалось разработать полноценную среду программирования роботов, которую оказалось возможным предложить школьникам и учителям в качестве замены используемых ныне в школах средств. QReal:Robots была представлена на "Открытых состязаниях Санкт-Петербурга по робототехнике" и на робототехническом фестивале "Робофест 2012" в Москве. В качестве доказательства применимости среды QReal:Robots к реальным задачам, решаемым школьниками, команда студентов приняла участие в соревнованиях в движении робота по линии с программой, реализованной целиком на QReal:Robots. Задача движения по линии состоит в том, что руководствуясь показанием датчиков освещённости робот должен проехать по нарисованной на полу кривой замкнутой чёрной линии за возможно меньшее время. Несмотря на то, что для студентов участие в соревнованиях стало практически первым опытом решения задач робототехники, им удалось показать довольно неплохие результаты, заняв места в середине таблицы, несмотря на то, что довольно многие участники использовали специально созданные для этой задачи роботы. QReal:Robots представлялся также в виде стендовых докладов, где вызвал большую заинтересованность у потенциальных пользователей. Было проведено анкетирование удобства пользовательского интерфейса, которое показало, что продукт достаточно хорош, чтобы вызывать у пользователей симпатию и желание им пользоваться.

Среду QReal:Robots вряд ли удалось бы разработать в столь короткие сроки вручную. Использование metaCASE-системы QReal позволило существенно упростить создание визуального языка и редактора диаграмм для него. Прототип языка был готов за несколько часов, так что уже после недели разработки первый функциональный прототип среды программирования, включающий в себя редактор диаграмм и интерпретатор, управляющий роботом по Bluetooth, был представлен специалистам по кибернетике. При создании языка наиболее затратным по времени оказался поиск подходящих иконок для блоков диаграммы. Создание метамодели языка с помощью метаредактора оказалось довольно быстрым, первая версия языка содержала порядка десятка блоков, находящихся друг с другом в несложных отношениях, и с тех пор язык лишь незначительно вырос, вся его метамодель в графическом виде помещается на один экран. Поскольку редактор диаграмм языка по метамодели генерируется автоматически, была возможность не только сэкономить время на разработке редактора, но и экспериментировать с языком, меняя блоки, их свойства и внешний вид. Кроме того, простота визуального представления синтаксиса языка дала возможность легко расширять и изменять его в дальнейшем, причём не только исходным авторам языка. Впоследствии разработка QReal:Robots была во многом передана студентам, которые без особых сложностей редактировали и расширяли язык по мере необходимости. Рассматривалась даже возможность позволить самим пользвателям менять язык, например, дать возможность учителям информатики настраивать язык под конкретное занятие, но такая возможность до сих пор не была реализована в силу серьёзной недоработанности средств метамоделирования в QReal.

Если синтаксис языка оказался хорошо формализуемым и процесс построения редактора языка по описанию синтаксиса удалось автоматизировать, то с семантикой ситуация оказалась хуже. Система QReal на момент разработки QReal:Robots не имела никаких средств описания семантики языка, так что вся инструментальная поддержка, включая интерпретатор диаграмм и генератор кода для заливки на робот, реализовывалась вручную, программированием на C++. Эта задача трудоёмка и сама по себе --- требовалось изучить систему прямых команд робота для управления им с компьютера, изучить API операционной системы робота для генерации кода для неё, наладить работу с Bluetooth, USB, кросскомпиляцию, прошивку робота, загрузку программы на робот, и прочие проблемы, не автоматизируемые в принципе. Однако же, некоторый код получился довольно шаблонным --- каждому блоку соответствовал некоторый класс на С++, реализовывавший его функциональность при интерпретации, и по крайней мере шаблоны для таких классов можно было бы генерировать автоматически по описанию языка. Интерпретатор в целом также мало связан конкретно с языком программирования роботов, так что, возможно, часть его можно было бы генерировать по описанию семантики языка, представленной в каком-то виде, а часть вынести в библиотеку и использовать в сгенерированном коде. Предполагается, что использование интерпретируемых языков программирования для описания части поведения интерпретатора позволило бы ускорить разработку, но эта идея ещё не была проверена.

Генератор кода представляется наиболее интересной целью для автоматизации, поскольку содержит много похожего от блока к блоку кода. Как и интерпретатор, генератор содержит неспецифичные для языка программирования роботов части, которые были бы применимы для всех визуальных языков с семантикой, похожей на семантику диаграмм активностей UML или блок-схем. Над автоматизацией создания генератора в QReal в данный момент ведётся работа, был создан язык описания правил генерации, берущий на себя многие типичные задачи, такие как обход графа модели и вывод текста. Тем не менее, такой язык не позволяет выполнять сложные алгоритмические действия, например, goto elimination, или поиск переменных в математических выражениях для дальнейшей автоматической генерации блока объявления переменных.

Таким образом, результатом эксперимента по разработке системы визуального программирования с помощью metaCASE-системы стало то, что с помощью такого подхода можно создать систему, которая была бы не хуже разработанных вручную, и при этом время на разработку визуального редактора с помощью метамоделирования можно сократить в несколько десятков раз по сравнению с разработкой редактора вручную. Однако, выигрыш при разработке и доведении до внедрения системы в целом оказался не таким значительным, как при разработке только редактора, потому как многие задачи принципиально неавтоматизируемы. В процессе эксперимента были выявлены типичные при разработке подобного рода систем задачи, которые можно в некоторой степени автоматизировать в metaCASE-системе, но их автоматизация требует дополнительных исследований. Большая часть таких задач требует изучения способов задания семантики визуальных языков. Уже сейчас DSM-подход доказал свои преимущества на конкретной практической задаче, и с помощью metaCASE-системы удалось создать востребованную систему, основанную на визуальных языках программирования, а дальнейшие исследования в этом направлении помогут сделать разработку подобных систем ещё проще, и даже дать возможность конечным пользователям менять синтаксис языка "на лету".

\begin{thebibliography}{9001}

  \bibitem{robots} \emph{Брыксин Т.А., Литвинов Ю.В.} Среда визуального программирования роботов QReal:Robots // Материалы международной конференции ``Информационные технологии в образовании и науке''. Самара. 2011. С. 332--334.
  
  \bibitem{logoTurtle} http://cyberneticzoo.com/?p=1711

\end{thebibliography}

\end{document}
